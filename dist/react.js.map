{
  "version": 3,
  "sources": ["../src/react.ts"],
  "sourcesContent": [
    "import { atom } from 'nanostores';\nimport { useStore } from '@nanostores/react';\nimport { useEffect, useState, useCallback } from 'react';\nimport type { CheckResponse } from './types';\n\n/**\n * Atom to trigger re-fetches across hooks\n */\nexport const $refreshTrigger = atom(0);\n\n/**\n * Hook to check feature permissions\n */\nexport function useCheck(\n  featureId: string,\n  options?: { organizationId?: string }\n) {\n  const [state, setState] = useState<{\n    data: CheckResponse | null;\n    loading: boolean;\n    error: Error | null;\n  }>({ data: null, loading: true, error: null });\n\n  const trigger = useStore($refreshTrigger);\n\n  const fetchCheck = useCallback(async () => {\n    setState(s => ({ ...s, loading: true, error: null }));\n    try {\n      const params = new URLSearchParams({ feature: featureId });\n      if (options?.organizationId) {\n        params.set('organizationId', options.organizationId);\n      }\n      const res = await fetch(`/api/auth/paymongo/check?${params}`);\n      if (!res.ok) throw new Error('Check failed');\n      const data: CheckResponse = await res.json();\n      setState({ data, loading: false, error: null });\n    } catch (e) {\n      setState({ data: null, loading: false, error: e as Error });\n    }\n  }, [featureId, options?.organizationId]);\n\n  useEffect(() => {\n    fetchCheck();\n  }, [fetchCheck, trigger]);\n\n  return {\n    allowed: state.data?.allowed ?? false,\n    balance: state.data?.balance,\n    limit: state.data?.limit,\n    planId: state.data?.planId,\n    loading: state.loading,\n    error: state.error,\n    refetch: fetchCheck\n  };\n}\n\n/**\n * Hook to get current subscription state\n */\nexport function useSubscription() {\n  const [state, setState] = useState<{\n    planId: string | null;\n    loading: boolean;\n    error: Error | null;\n  }>({ planId: null, loading: true, error: null });\n\n  const trigger = useStore($refreshTrigger);\n\n  const refresh = useCallback(async () => {\n    setState(s => ({ ...s, loading: true, error: null }));\n    try {\n      const res = await fetch('/api/auth/paymongo/check?feature=_subscription');\n      if (!res.ok) throw new Error('Failed to get subscription');\n      const data: CheckResponse = await res.json();\n      setState({ planId: data.planId ?? null, loading: false, error: null });\n    } catch (e) {\n      setState({ planId: null, loading: false, error: e as Error });\n    }\n  }, []);\n\n  useEffect(() => {\n    refresh();\n  }, [refresh, trigger]);\n\n  return {\n    planId: state.planId,\n    loading: state.loading,\n    error: state.error,\n    refresh\n  };\n}\n\n/**\n * Trigger global refresh for all hooks\n */\nexport function refreshBilling() {\n  $refreshTrigger.set($refreshTrigger.get() + 1);\n}\n"
  ],
  "mappings": ";AAAA;AACA;AACA;AAMO,IAAM,kBAAkB,KAAK,CAAC;AAK9B,SAAS,QAAQ,CACtB,WACA,SACA;AAAA,EACA,OAAO,OAAO,YAAY,SAIvB,EAAE,MAAM,MAAM,SAAS,MAAM,OAAO,KAAK,CAAC;AAAA,EAE7C,MAAM,UAAU,SAAS,eAAe;AAAA,EAExC,MAAM,aAAa,YAAY,YAAY;AAAA,IACzC,SAAS,QAAM,KAAK,GAAG,SAAS,MAAM,OAAO,KAAK,EAAE;AAAA,IACpD,IAAI;AAAA,MACF,MAAM,SAAS,IAAI,gBAAgB,EAAE,SAAS,UAAU,CAAC;AAAA,MACzD,IAAI,SAAS,gBAAgB;AAAA,QAC3B,OAAO,IAAI,kBAAkB,QAAQ,cAAc;AAAA,MACrD;AAAA,MACA,MAAM,MAAM,MAAM,MAAM,4BAA4B,QAAQ;AAAA,MAC5D,IAAI,CAAC,IAAI;AAAA,QAAI,MAAM,IAAI,MAAM,cAAc;AAAA,MAC3C,MAAM,OAAsB,MAAM,IAAI,KAAK;AAAA,MAC3C,SAAS,EAAE,MAAM,SAAS,OAAO,OAAO,KAAK,CAAC;AAAA,MAC9C,OAAO,GAAG;AAAA,MACV,SAAS,EAAE,MAAM,MAAM,SAAS,OAAO,OAAO,EAAW,CAAC;AAAA;AAAA,KAE3D,CAAC,WAAW,SAAS,cAAc,CAAC;AAAA,EAEvC,UAAU,MAAM;AAAA,IACd,WAAW;AAAA,KACV,CAAC,YAAY,OAAO,CAAC;AAAA,EAExB,OAAO;AAAA,IACL,SAAS,MAAM,MAAM,WAAW;AAAA,IAChC,SAAS,MAAM,MAAM;AAAA,IACrB,OAAO,MAAM,MAAM;AAAA,IACnB,QAAQ,MAAM,MAAM;AAAA,IACpB,SAAS,MAAM;AAAA,IACf,OAAO,MAAM;AAAA,IACb,SAAS;AAAA,EACX;AAAA;AAMK,SAAS,eAAe,GAAG;AAAA,EAChC,OAAO,OAAO,YAAY,SAIvB,EAAE,QAAQ,MAAM,SAAS,MAAM,OAAO,KAAK,CAAC;AAAA,EAE/C,MAAM,UAAU,SAAS,eAAe;AAAA,EAExC,MAAM,UAAU,YAAY,YAAY;AAAA,IACtC,SAAS,QAAM,KAAK,GAAG,SAAS,MAAM,OAAO,KAAK,EAAE;AAAA,IACpD,IAAI;AAAA,MACF,MAAM,MAAM,MAAM,MAAM,gDAAgD;AAAA,MACxE,IAAI,CAAC,IAAI;AAAA,QAAI,MAAM,IAAI,MAAM,4BAA4B;AAAA,MACzD,MAAM,OAAsB,MAAM,IAAI,KAAK;AAAA,MAC3C,SAAS,EAAE,QAAQ,KAAK,UAAU,MAAM,SAAS,OAAO,OAAO,KAAK,CAAC;AAAA,MACrE,OAAO,GAAG;AAAA,MACV,SAAS,EAAE,QAAQ,MAAM,SAAS,OAAO,OAAO,EAAW,CAAC;AAAA;AAAA,KAE7D,CAAC,CAAC;AAAA,EAEL,UAAU,MAAM;AAAA,IACd,QAAQ;AAAA,KACP,CAAC,SAAS,OAAO,CAAC;AAAA,EAErB,OAAO;AAAA,IACL,QAAQ,MAAM;AAAA,IACd,SAAS,MAAM;AAAA,IACf,OAAO,MAAM;AAAA,IACb;AAAA,EACF;AAAA;AAMK,SAAS,cAAc,GAAG;AAAA,EAC/B,gBAAgB,IAAI,gBAAgB,IAAI,IAAI,CAAC;AAAA;",
  "debugId": "CB55344ACA6EE76564756E2164756E21",
  "names": []
}