{
  "version": 3,
  "sources": ["../node_modules/nanostores/clean-stores/index.js", "../node_modules/nanostores/atom/index.js", "../node_modules/nanostores/listen-keys/index.js", "../src/client.ts"],
  "sourcesContent": [
    "import { cleanTasks } from '../task/index.js'\n\nexport let clean = Symbol('clean')\n\nexport let cleanStores = (...stores) => {\n  if (process.env.NODE_ENV === 'production') {\n    throw new Error(\n      'cleanStores() can be used only during development or tests'\n    )\n  }\n  cleanTasks()\n  for (let $store of stores) {\n    if ($store) {\n      if ($store.mocked) delete $store.mocked\n      if ($store[clean]) $store[clean]()\n    }\n  }\n}\n",
    "import { clean } from '../clean-stores/index.js'\n\nlet listenerQueue = []\nlet lqIndex = 0\nconst QUEUE_ITEMS_PER_LISTENER = 4\nexport let epoch = 0\n\n/* @__NO_SIDE_EFFECTS__ */\nexport const atom = initialValue => {\n  let listeners = []\n  let $atom = {\n    get() {\n      if (!$atom.lc) {\n        $atom.listen(() => {})()\n      }\n      return $atom.value\n    },\n    lc: 0,\n    listen(listener) {\n      $atom.lc = listeners.push(listener)\n\n      return () => {\n        for (\n          let i = lqIndex + QUEUE_ITEMS_PER_LISTENER;\n          i < listenerQueue.length;\n\n        ) {\n          if (listenerQueue[i] === listener) {\n            listenerQueue.splice(i, QUEUE_ITEMS_PER_LISTENER)\n          } else {\n            i += QUEUE_ITEMS_PER_LISTENER\n          }\n        }\n\n        let index = listeners.indexOf(listener)\n        if (~index) {\n          listeners.splice(index, 1)\n          if (!--$atom.lc) $atom.off()\n        }\n      }\n    },\n    notify(oldValue, changedKey) {\n      epoch++\n      let runListenerQueue = !listenerQueue.length\n      for (let listener of listeners) {\n        listenerQueue.push(listener, $atom.value, oldValue, changedKey)\n      }\n\n      if (runListenerQueue) {\n        for (\n          lqIndex = 0;\n          lqIndex < listenerQueue.length;\n          lqIndex += QUEUE_ITEMS_PER_LISTENER\n        ) {\n          listenerQueue[lqIndex](\n            listenerQueue[lqIndex + 1],\n            listenerQueue[lqIndex + 2],\n            listenerQueue[lqIndex + 3]\n          )\n        }\n        listenerQueue.length = 0\n      }\n    },\n    /* It will be called on last listener unsubscribing.\n       We will redefine it in onMount and onStop. */\n    off() {},\n    set(newValue) {\n      let oldValue = $atom.value\n      if (oldValue !== newValue) {\n        $atom.value = newValue\n        $atom.notify(oldValue)\n      }\n    },\n    subscribe(listener) {\n      let unbind = $atom.listen(listener)\n      listener($atom.value)\n      return unbind\n    },\n    value: initialValue\n  }\n\n  if (process.env.NODE_ENV !== 'production') {\n    $atom[clean] = () => {\n      listeners = []\n      $atom.lc = 0\n      $atom.off()\n    }\n  }\n\n  return $atom\n}\n\nexport const readonlyType = store => store\n",
    "export function listenKeys($store, keys, listener) {\n  let keysSet = new Set(keys).add(undefined)\n  return $store.listen((value, oldValue, changed) => {\n    if (keysSet.has(changed)) {\n      listener(value, oldValue, changed)\n    }\n  })\n}\n\nexport function subscribeKeys($store, keys, listener) {\n  let unbind = listenKeys($store, keys, listener)\n  listener($store.value)\n  return unbind\n}\n",
    "import type { BetterAuthClientPlugin } from \"better-auth/client\";\nimport type { BetterFetchOption } from \"@better-fetch/fetch\";\nimport { atom } from \"nanostores\";\nimport type { paymongo } from \"./server\";\nimport type { SubscriptionData } from \"./types\";\n\n// Atoms for reactive subscription state\nexport const subscriptionAtom = atom<SubscriptionData | null>(null);\nexport const subscriptionLoadingAtom = atom<boolean>(false);\nexport const subscriptionErrorAtom = atom<Error | null>(null);\n\nexport const paymongoClient = () => {\n    return {\n        id: \"paymongo\",\n        $InferServerPlugin: {} as ReturnType<typeof paymongo>,\n\n        getAtoms: () => {\n            return {\n                $subscription: subscriptionAtom,\n                $subscriptionLoading: subscriptionLoadingAtom,\n                $subscriptionError: subscriptionErrorAtom\n            };\n        },\n\n        getActions: ($fetch: <T>(url: string, options?: BetterFetchOption) => Promise<{ data: T | null; error: { message: string } | null }>) => ({\n            /**\n             * Fetch subscription and update atoms\n             */\n            fetchSubscription: async (options?: { organizationId?: string }) => {\n                subscriptionLoadingAtom.set(true);\n                subscriptionErrorAtom.set(null);\n\n                try {\n                    const query = options?.organizationId ? `?organizationId=${options.organizationId}` : \"\";\n                    const result = await $fetch<SubscriptionData | null>(`/paymongo/get-subscription${query}`, {\n                        method: \"GET\"\n                    });\n\n                    if (result.error) {\n                        subscriptionErrorAtom.set(new Error(result.error.message));\n                        return { data: null, error: result.error };\n                    } else {\n                        subscriptionAtom.set(result.data);\n                        return { data: result.data, error: null };\n                    }\n                } catch (e) {\n                    const error = e instanceof Error ? e : new Error(\"Failed to fetch subscription\");\n                    subscriptionErrorAtom.set(error);\n                    return { data: null, error: { message: error.message } };\n                } finally {\n                    subscriptionLoadingAtom.set(false);\n                }\n            },\n\n            /**\n             * Get the current plan ID for the active organization or user\n             */\n            getPlan: async (options?: { organizationId?: string }, fetchOptions?: BetterFetchOption) => {\n                const query = options?.organizationId ? `?organizationId=${options.organizationId}` : \"\";\n                const res = await $fetch<SubscriptionData | null>(`/paymongo/get-subscription${query}`, {\n                    method: \"GET\",\n                    ...fetchOptions\n                });\n                return {\n                    data: res.data?.planId ?? null,\n                    error: res.error\n                };\n            },\n\n            /**\n             * Get the full subscription data for the active organization or user\n             */\n            getSubscription: async (options?: { organizationId?: string }, fetchOptions?: BetterFetchOption) => {\n                const query = options?.organizationId ? `?organizationId=${options.organizationId}` : \"\";\n                return $fetch<SubscriptionData | null>(`/paymongo/get-subscription${query}`, {\n                    method: \"GET\",\n                    ...fetchOptions\n                });\n            },\n\n            /**\n             * Check if the organization or user has an active subscription\n             */\n            hasActiveSubscription: async (options?: { organizationId?: string }, fetchOptions?: BetterFetchOption) => {\n                const query = options?.organizationId ? `?organizationId=${options.organizationId}` : \"\";\n                const res = await $fetch<SubscriptionData | null>(`/paymongo/get-subscription${query}`, {\n                    method: \"GET\",\n                    ...fetchOptions\n                });\n                const isActive = res.data?.status === \"active\" || res.data?.status === \"trialing\";\n                return {\n                    data: isActive,\n                    error: res.error\n                };\n            }\n        })\n    } satisfies BetterAuthClientPlugin;\n};\n"
  ],
  "mappings": "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",
  "debugId": "3C215171A4791BF664756E2164756E21",
  "names": []
}